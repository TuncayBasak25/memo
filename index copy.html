<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Memo Game</title>
    <style>
        body,
        html {
            height: 100%;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: Arial, sans-serif;
            background-color: grey;
        }

        .container {
            text-align: center;
            font-size: 2rem;
        }

        input,
        button,
        select {
            font-size: 1.5rem;
            padding: 10px;
            margin: 10px;
        }

        #question,
        #output,
        #correctAnswer,
        #score,
        #timer {
            font-size: 2rem;
            margin-top: 20px;
        }

        #correctAnswer {
            color: red;
        }
    </style>
    <script src="./socket.js"></script>
</head>

<body>
    <div class="container">
        <p id="question">
            Select difficulty and click "Start" to begin the game
        </p>
        <select id="difficulty">
            <option value="normal">Normal</option>
            <option value="challenge">Challenge Mode</option>
        </select>
        <button onclick="startGame()" id="startButton">Start</button>
        <p id="timer">Time: 10</p>
        <input type="text" id="answerInput" placeholder="Your answer" style="display: none"
            onkeydown="handleKeyPress(event)" />
        <p id="output"></p>
        <p id="correctAnswer"></p>
        <p id="score">Score: 0</p>
    </div>

    <script>
        const mots = [
            "chat",
            "miel",
            "lune",
            "arbre",
            "livre",
            "ballon",
            "éléphant",
            "chaussure",
            "bateau",
            "ordinateur",
            "train",
            "boite",
            "montagne",
            "sablier",
            "girafe",
            "corde",
            "aspirateur",
            "fourchette",
            "poubelle",
            "fromage",
            "crayon",
            "bougie",
            "cerf",
            "cloche",
            "cheval",
            "pomme",
            "cigare",
            "marteau",
            "fusil",
            "tigre",
            "chaise",
            "champignon",
            "vache",
            "pirate",
            "échelle",
            "bouclier",
            "robot",
            "lunette",
            "éponge",
            "cookie",
            "parapluie",
            "renard",
            "crocodile",
            "bague",
            "parachute",
            "fleur",
            "citron",
            "chien",
            "télévision",
            "souris",
            "brosse",
            "escalier",
            "piano",
            "kelox",
            "scie",
            "caméra",
            "médaille",
            "tacos",
            "lampe",
            "sac",
            "horloge",
            "loup",
            "mouton",
            "ours",
            "singe",
            "serpent",
            "pizza",
            "trompette",
            "banane",
            "crabe",
            "requin",
            "arc",
            "glaçon",
            "croissant",
            "hélicoptère",
            "carotte",
            "hibou",
            "plume",
            "cerf-volant",
            "cochon",
            "poulet",
            "épouvantail",
            "carte",
            "épée",
            "coquillage",
            "valise",
            "licorne",
            "peinture",
            "toboggan",
            "montgolfière",
            "ananas",
            "papillon",
            "perceuse",
            "aigle",
            "camionnette",
            "jumelle",
            "nuage",
            "chariot",
            "tapis",
            "oeuf",
        ];

        let usedwords = [];

        let randomIndex = 0,
            questionType,
            score = 0,
            rounds = 0,
            timer,
            timeLimit = 10;
        let challengeMode = false,
            startTime;

        let wordcount = 0;
        let numbercount = 0;
        function startGame() {
            const difficulty = document.getElementById("difficulty").value;
            challengeMode = difficulty === "challenge";
            score = 0;
            rounds = 0;
            timeLimit = 10;

            wordcount = 0;
            numbercount = 0;

            document.getElementById("score").textContent =
                `Score: ${score}`;
            document.getElementById("timer").textContent =
                `Time: ${timeLimit}`;
            document.getElementById("startButton").style.display = "none";
            document.getElementById("difficulty").style.display = "none";
            document.getElementById("answerInput").style.display = "inline";
            askQuestion();
        }


        function askQuestion() {
            if (rounds >= 20 && !challengeMode) {
                endGame();
                return;
            }

            randomIndex = Math.floor(Math.random() * mots.length);
            while (usedwords.indexOf(mots[randomIndex]) > -1)
                randomIndex = Math.floor(Math.random() * mots.length);

            questionType = Math.random() > 0.5 ? "mot" : "nombre";
            if (wordcount == 10) questionType = "nombre";
            if (numbercount == 10) questionType = "mot";
            if (questionType == "mot") wordcount++
            else numbercount++;
            const questionText =
                questionType === "mot"
                    ? `Quel est le mot pour le nombre ${randomIndex} ?`
                    : `Quel est le nombre pour le mot "${mots[randomIndex]}" ?`;

            document.getElementById("question").textContent = questionText;
            document.getElementById("output").textContent = "";
            //document.getElementById("correctAnswer").textContent = "";
            document.getElementById("answerInput").value = "";
            document.getElementById("answerInput").focus();

            startTime = new Date(); // Track time when question is asked
            resetTimer();
            startCountdown();
            rounds++;
            usedwords.push(mots[randomIndex]);
        }

        function submitAnswer() {
            clearInterval(timer); // Stop countdown
            let answer = document
                .getElementById("answerInput")
                .value.trim();
            const output = document.getElementById("output");
            const correctAnswerDisplay =
                document.getElementById("correctAnswer");

            if (typeof answer == "string") answer = answer.toLowerCase();

            if (answer === "quit") {
                output.textContent = "Fin du jeu !";
                resetGame();
                return;
            }

            const endTime = new Date();
            const timeTaken = (endTime - startTime) / 1000; // Time in seconds

            if (
                (questionType === "mot" && answer === mots[randomIndex]) ||
                (questionType === "nombre" &&
                    parseInt(answer) === randomIndex)
            ) {
                output.textContent = "Correct !";
                correctAnswerDisplay.textContent = ""; // Clear previous incorrect answer
                calculateScore(timeTaken); // Calculate score based on response time
            } else {
                const correctAnsText =
                    questionType === "mot"
                        ? `${mots[randomIndex]} = ${randomIndex}`
                        : `${randomIndex} = ${mots[randomIndex]}`;
                output.textContent = "Incorrect.";
                correctAnswerDisplay.textContent = `La réponse correcte est : ${correctAnsText}`;
                score -= 10; // Deduct points for wrong answer
            }

            if (challengeMode && rounds % 5 === 0 && timeLimit > 3) {
                timeLimit--; // Decrease time limit every 5 rounds in challenge mode
            }

            document.getElementById("score").textContent =
                `Score: ${score}`;
            document.getElementById("timer").textContent =
                `Time: ${timeLimit}`;
            askQuestion();
        }

        function calculateScore(timeTaken) {
            let points = 0;

            if (questionType === "mot") {
                if (timeTaken <= 2) points = 5;
                else if (timeTaken <= 4) points = 4;
                else if (timeTaken <= 6) points = 3;
                else if (timeTaken <= 7) points = 2;
                else points = 1;
            } else {
                // questionType is "nombre"
                if (timeTaken <= 1) points = 5;
                else if (timeTaken <= 2) points = 4;
                else if (timeTaken <= 3) points = 3;
                else if (timeTaken <= 4) points = 2;
                else points = 1;
            }

            score += points;
        }

        function startCountdown() {
            let timeRemaining = timeLimit;
            document.getElementById("timer").textContent =
                `Time: ${timeRemaining}`;
            timer = setInterval(() => {
                timeRemaining--;
                document.getElementById("timer").textContent =
                    `Time: ${timeRemaining}`;
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    timeout();
                }
            }, 1000);
        }

        function timeout() {
            document.getElementById("output").textContent = "Time's up!";
            const correctAnswerText =
                questionType === "mot"
                    ? `${mots[randomIndex]} = ${randomIndex}`
                    : `${randomIndex} = ${mots[randomIndex]}`;
            document.getElementById("correctAnswer").textContent =
                `La réponse correcte est : ${correctAnswerText}`;
            score -= 10;
            document.getElementById("score").textContent =
                `Score: ${score}`;
            askQuestion();
        }

        function handleKeyPress(event) {
            if (event.key === "Enter") {
                submitAnswer();
            }
        }

        function resetGame() {
            document.getElementById("question").textContent =
                "Select difficulty and click 'Start' to begin the game";
            document.getElementById("answerInput").style.display = "none";
            document.getElementById("startButton").style.display = "inline";
            document.getElementById("difficulty").style.display = "inline";
            usedwords = [];
        }

        function endGame() {
            clearInterval(timer);
            document.getElementById("question").textContent = "Game Over!";
            document.getElementById("output").textContent = `Your final score is: ${score}`;
            document.getElementById("answerInput").style.display = "none";
            document.getElementById("startButton").style.display = "inline";
            document.getElementById("difficulty").style.display = "inline";
        }

        function resetTimer() {
            clearInterval(timer);
            document.getElementById("timer").textContent =
                `Time: ${timeLimit}`;
        }
    </script>
    <script src="./memo.js"></script>
</body>

</html>